<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel Strategy Pro</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #e2e8f0;
            --input-bg: #334155;
            --input-border: #475569;
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --success-color: #4ade80;
            --danger-color: #f87171;
            --warning-color: #facc15;
            --info-color: #38bdf8;
            --divider-color: #334155;
            --muted-text: #94a3b8;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            --orange-color: #fb923c;
        }

        [data-theme="light"] {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --success-color: #16a34a;
            --danger-color: #dc2626;
            --warning-color: #d97706;
            --info-color: #0ea5e9;
            --divider-color: #e2e8f0;
            --muted-text: #64748b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --orange-color: #ea580c;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            transition: all 0.3s;
        }

        .container {
            max-width: 850px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--divider-color);
            padding-bottom: 15px;
        }
        pre.ascii-box {
            background-color: var(--input-bg);
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--input-border);
            overflow-x: auto;
            font-size: 0.8rem;
            line-height: 1.4;
            white-space: pre;
        }

        h1 { margin: 0; font-size: 1.5rem; }

        .controls { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-toggle {
            background: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--input-border);
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn-toggle:hover { border-color: var(--primary-color); }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 25px;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .grid-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* Compact row for extra calls */
        .grid-row.compact {
            grid-template-columns: 80px 1fr 1fr 1fr;
            align-items: end;
            gap: 10px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 6px;
        }
        
        /* Compact row for close call entries */
        .grid-row.compact-close {
            grid-template-columns: 80px 1fr 1fr 1fr 1fr;
            align-items: end;
            gap: 10px;
            margin-bottom: 10px;
            background: rgba(251, 146, 60, 0.08);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--orange-color);
        }
        
        @media (max-width: 600px) {
            .grid-row.compact {
                grid-template-columns: 1fr 1fr;
            }
            .grid-row.compact > div:first-child {
                grid-column: span 2;
                padding-bottom: 5px;
                border-bottom: 1px solid var(--divider-color);
                margin-bottom: 5px;
            }
            .grid-row.compact-close {
                grid-template-columns: 1fr 1fr;
            }
            .grid-row.compact-close > div:first-child {
                grid-column: span 2;
                padding-bottom: 5px;
                border-bottom: 1px solid var(--divider-color);
                margin-bottom: 5px;
            }
        }

        .form-group { display: flex; flex-direction: column; }
        label { font-size: 0.85rem; margin-bottom: 5px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        
        input, select {
            padding: 10px;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary-color); }

        .divider { height: 1px; background-color: var(--divider-color); margin: 25px 0; }
        .note { font-size: 0.85rem; color: var(--muted-text); margin-top: 5px; }

        .btn-calc {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-calc:hover { background-color: var(--primary-hover); transform: translateY(-1px); }

        /* Results */
        .result-card {
            background-color: var(--input-bg);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid var(--input-border);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1rem;
            align-items: center;
        }

        .result-row.total {
            font-size: 1.3rem;
            font-weight: bold;
            border-top: 1px dashed var(--divider-color);
            padding-top: 15px;
            margin-top: 15px;
        }

        .profit { color: var(--success-color); }
        .loss { color: var(--danger-color); }
        .neutral { color: var(--warning-color); font-weight: bold; }
        .highlight-box {
            background: rgba(59, 130, 246, 0.15);
            padding: 4px 8px;
            border-radius: 4px;
            color: var(--info-color);
            font-weight: bold;
        }
        
        .close-cost {
            color: var(--orange-color);
        }
        
        .benchmark-box {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255,255,255,0.03);
            border-left: 4px solid var(--warning-color);
            border-radius: 4px;
        }
        .benchmark-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--muted-text);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .close-section {
            background: rgba(251, 146, 60, 0.05);
            border: 1px solid rgba(251, 146, 60, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .close-section .section-title {
            color: var(--orange-color);
            margin-top: 0;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <h1 data-i18n="appTitle">Wheel Strategy Calculate</h1>
        <div class="controls">
            <button class="btn-toggle" onclick="toggleTheme()" id="themeBtn">ğŸŒ Light</button>
            <button class="btn-toggle" onclick="toggleAsciiHelp()" id="asciiBtn" data-i18n="btnAscii">
               Strategy Guide
            </button>
            <button class="btn-toggle" onclick="toggleLang()" id="langBtn">ä¸­æ–‡</button>
        </div>
    </div>
        <div id="asciiHelp" class="result-card" style="display:none; margin-bottom: 15px;">
        <div class="section-title" style="margin-top:0;" data-i18n="asciiTitle">
            Wheel Strategy Guide
        </div>
        <p class="note" data-i18n="asciiIntro">
            This diagram explains the sell put â†’ assignment â†’ covered call fund cycle.
        </p>

        <!-- è‹±æ–‡ç‰ˆ ASCII -->
        <pre id="asciiEn" class="ascii-box">
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Step 1: Sell Cash-Secured Put      â”‚
            â”‚  â€¢ Collect premium                 â”‚
            â”‚  â€¢ Set potential entry price       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         |
                         v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Step 2: Market Movement             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               /                          \
  Price â‰¥ strike (good/ok)          Price < strike (dip)
  ----------------------------      ------------------------
  Put expires worthless            Put assigned â†’ you buy shares
  You keep premium                 at strike - premium
               \                          /
                \                        /
                 v                      v
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Hold no shares  â”‚     â”‚ Step 3: Now you own stock â”‚
     â”‚ (profit = prem) â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                |
                                        v
             Market strong                        Market weak
             ---------------------                ---------------------
             Hold shares â†’ growth                 Sell covered call
             (no action needed)                   â†’ collect premium
                                        |
                                        v
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Step 4: Fund Cycle Continues        â”‚
                     â”‚  â€¢ If called away â†’ return to Step 1â”‚
                     â”‚  â€¢ If not called â†’ sell call again   â”‚
                     â”‚  â€¢ Close call early â†’ pay to exit   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>

        <!-- ä¸­æ–‡ç‰ˆ ASCII -->
        <pre id="asciiZh" class="ascii-box" style="display:none;">
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ­¥é©Ÿ 1ï¼šè³£å‡ºç¾é‡‘æ“”ä¿è³£æ¬Šï¼ˆPutï¼‰      â”‚
            â”‚  â€¢ æ”¶å–æ¬Šåˆ©é‡‘                       â”‚
            â”‚  â€¢ è¨­å®šæ½›åœ¨é€²å ´åƒ¹æ ¼                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         |
                         v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ­¥é©Ÿ 2ï¼šç­‰å¾…å¸‚å ´æ³¢å‹•                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               /                          \
  åƒ¹æ ¼ â‰¥ å±¥ç´„åƒ¹ï¼ˆè¡Œæƒ…ä¸éŒ¯ï¼‰          åƒ¹æ ¼ < å±¥ç´„åƒ¹ï¼ˆè¡Œæƒ…è½‰å¼±ï¼‰
  ----------------------------      ------------------------
  è³£æ¬Šåˆ°æœŸè®Šæˆç„¡åƒ¹å€¼               è³£æ¬Šè¢«æŒ‡æ´¾ â†’ ä½ è²·å…¥è‚¡ç¥¨
  ä½ ä¿ç•™å…¨éƒ¨æ¬Šåˆ©é‡‘                 æˆæœ¬ â‰ˆ å±¥ç´„åƒ¹ - æ¬Šåˆ©é‡‘
               \                          /
                \                        /
                 v                      v
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ æœªæŒæœ‰è‚¡ç¥¨       â”‚     â”‚ æ­¥é©Ÿ 3ï¼šç¾åœ¨ä½ æŒæœ‰è‚¡ç¥¨      â”‚
     â”‚ï¼ˆç²åˆ© = æ¬Šåˆ©é‡‘ï¼‰ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                |
                                        v
             è¡Œæƒ…è½‰å¼·                             è¡Œæƒ…è½‰å¼±
             ---------------------                ---------------------
             æŒè‚¡ç­‰å¾…ä¸Šæ¼²                         è³£å‡ºè²·æ¬Šï¼ˆCovered Callï¼‰
             ï¼ˆä¸ç”¨å¤šåšäº‹ï¼‰                      â†’ æ”¶å–æ¬Šåˆ©é‡‘
                                        |
                                        v
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ æ­¥é©Ÿ 4ï¼šè³‡é‡‘å¾ªç’°æŒçºŒé€²è¡Œ             â”‚
                     â”‚  â€¢ è‹¥è¢« Call èµ° â†’ å›åˆ°æ­¥é©Ÿ 1         â”‚
                     â”‚  â€¢ è‹¥æœªè¢« Call èµ° â†’ ç¹¼çºŒè³£å‡ºè²·æ¬Š     â”‚
                     â”‚  â€¢ æå‰å¹³å€‰ â†’ ä»˜è²»é—œé–‰éƒ¨ä½           â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>
    </div>

    <div class="section-title" data-i18n="secPut">1. Capital & Sell Put</div>
    <div class="grid-row">
        <div class="form-group">
            <label data-i18n="lblInitCap">Initial Capital (USD)</label>
            <input type="number" id="initialCapital" class="save-input" value="10000">
        </div>
    </div>

    <div class="grid-row">
        <div class="form-group">
            <label data-i18n="lblPutStrike">Put Strike Price</label>
            <input type="number" id="putStrike" class="save-input" value="50" step="0.1">
        </div>
        <div class="form-group">
            <label data-i18n="lblPutPrem">Put Premium</label>
            <input type="number" id="putPremium" class="save-input" value="1.5" step="0.01">
        </div>
        <div class="form-group">
            <label data-i18n="lblPutQty">Put Contracts</label>
            <input type="number" id="putQty" class="save-input" value="1">
        </div>
        <div class="form-group">
            <label data-i18n="lblPutDays">Put Duration (Days)</label>
            <input type="number" id="putDays" class="save-input" value="7" placeholder="e.g. 7">
        </div>
    </div>

    <div class="divider"></div>

    <div class="section-title" data-i18n="secCall">2. Assignment & Covered Call</div>
    <p class="note" data-i18n="noteAssigned">* Only fill if assigned.</p>
    
    <div class="grid-row">
        <div class="form-group">
            <label data-i18n="lblCallStrike">Initial Call Strike</label>
            <input type="number" id="callStrike" class="save-input" value="55" step="0.1">
        </div>
        <div class="form-group">
            <label data-i18n="lblCallPrem">Call Premium</label>
            <input type="number" id="callPremium" class="save-input" value="0.8" step="0.01">
        </div>
         <div class="form-group">
            <label data-i18n="lblCallDays">Call Duration (Days)</label>
            <input type="number" id="callDays" class="save-input" value="0" placeholder="e.g. 7">
        </div>
    </div>
    <div class="grid-row">
        <div class="form-group">
            <label data-i18n="lblCallQty">Call Contracts</label>
            <input type="number" id="callQty" class="save-input" value="1">
        </div>
        <div class="form-group">
            <label data-i18n="lblDividend">Dividends Collected</label>
            <input type="number" id="dividends" class="save-input" value="0" step="0.01" placeholder="Total Cash">
        </div>
    </div>

    <div class="divider"></div>

    <div class="section-title" data-i18n="secAdjust">3. Additional Calls / Rolling</div>
    <p class="note" style="margin-bottom: 15px;" data-i18n="noteAdjust">If New Trade: Enter full Premium. If Rolling: Enter Net Credit (New - Old).</p>

    <div class="grid-row compact">
        <div style="font-weight: bold; color: var(--muted-text); padding-bottom: 12px;">#1</div>
        <div class="form-group">
            <label data-i18n="lblNewStrike">Strike (Opt)</label>
            <input type="number" id="roll1Strike" class="save-input" placeholder="e.g. 54" step="0.1">
        </div>
        <div class="form-group">
            <label data-i18n="lblNetCredit">Premium / Credit</label>
            <input type="number" id="roll1Prem" class="save-input" placeholder="0.00" step="0.01">
        </div>
        <div class="form-group">
            <label data-i18n="lblDays">Days</label>
            <input type="number" id="roll1Days" class="save-input" placeholder="0">
        </div>
    </div>
    <div class="grid-row compact">
        <div style="font-weight: bold; color: var(--muted-text); padding-bottom: 12px;">#2</div>
        <div class="form-group">
            <label data-i18n="lblNewStrike">Strike (Opt)</label>
            <input type="number" id="roll2Strike" class="save-input" placeholder="e.g. 53" step="0.1">
        </div>
        <div class="form-group">
            <label data-i18n="lblNetCredit">Premium / Credit</label>
            <input type="number" id="roll2Prem" class="save-input" placeholder="0.00" step="0.01">
        </div>
        <div class="form-group">
            <label data-i18n="lblDays">Days</label>
            <input type="number" id="roll2Days" class="save-input" placeholder="0">
        </div>
    </div>
    <div class="grid-row compact">
        <div style="font-weight: bold; color: var(--muted-text); padding-bottom: 12px;">#3</div>
        <div class="form-group">
            <label data-i18n="lblNewStrike">Strike (Opt)</label>
            <input type="number" id="roll3Strike" class="save-input" placeholder="e.g. 52" step="0.1">
        </div>
        <div class="form-group">
            <label data-i18n="lblNetCredit">Premium / Credit</label>
            <input type="number" id="roll3Prem" class="save-input" placeholder="0.00" step="0.01">
        </div>
        <div class="form-group">
            <label data-i18n="lblDays">Days</label>
            <input type="number" id="roll3Days" class="save-input" placeholder="0">
        </div>
    </div>

    <div class="divider"></div>
    
    <!-- NEW SECTION: Close Sell Call -->
    <div class="section-title" style="color: var(--orange-color);" data-i18n="secClose">4. Close Sell Call (Buy to Close)</div>
    <p class="note" style="margin-bottom: 15px;" data-i18n="noteClose">If you bought back (closed) any call before expiration, enter the cost here. This reduces your net premium.</p>
    
    <div class="close-section">
        <div class="grid-row compact-close">
            <div style="font-weight: bold; color: var(--orange-color); padding-bottom: 12px;">Close #1</div>
            <div class="form-group">
                <label data-i18n="lblCloseWhich">Which Call?</label>
                <select id="close1Which" class="save-input">
                    <option value="" data-i18n="optSelectCall">-- Select --</option>
                    <option value="initial" data-i18n="optInitialCall">Initial Call</option>
                    <option value="roll1" data-i18n="optRoll1">Roll #1</option>
                    <option value="roll2" data-i18n="optRoll2">Roll #2</option>
                    <option value="roll3" data-i18n="optRoll3">Roll #3</option>
                </select>
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseCost">Close Cost (per share)</label>
                <input type="number" id="close1Cost" class="save-input" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseDays">Days Held</label>
                <input type="number" id="close1Days" class="save-input" placeholder="0">
            </div>
        </div>
        
        <div class="grid-row compact-close">
            <div style="font-weight: bold; color: var(--orange-color); padding-bottom: 12px;">Close #2</div>
            <div class="form-group">
                <label data-i18n="lblCloseWhich">Which Call?</label>
                <select id="close2Which" class="save-input">
                    <option value="" data-i18n="optSelectCall">-- Select --</option>
                    <option value="initial" data-i18n="optInitialCall">Initial Call</option>
                    <option value="roll1" data-i18n="optRoll1">Roll #1</option>
                    <option value="roll2" data-i18n="optRoll2">Roll #2</option>
                    <option value="roll3" data-i18n="optRoll3">Roll #3</option>
                </select>
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseCost">Close Cost (per share)</label>
                <input type="number" id="close2Cost" class="save-input" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseDays">Days Held</label>
                <input type="number" id="close2Days" class="save-input" placeholder="0">
            </div>
        </div>
        
        <div class="grid-row compact-close">
            <div style="font-weight: bold; color: var(--orange-color); padding-bottom: 12px;">Close #3</div>
            <div class="form-group">
                <label data-i18n="lblCloseWhich">Which Call?</label>
                <select id="close3Which" class="save-input">
                    <option value="" data-i18n="optSelectCall">-- Select --</option>
                    <option value="initial" data-i18n="optInitialCall">Initial Call</option>
                    <option value="roll1" data-i18n="optRoll1">Roll #1</option>
                    <option value="roll2" data-i18n="optRoll2">Roll #2</option>
                    <option value="roll3" data-i18n="optRoll3">Roll #3</option>
                </select>
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseCost">Close Cost (per share)</label>
                <input type="number" id="close3Cost" class="save-input" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label data-i18n="lblCloseDays">Days Held</label>
                <input type="number" id="close3Days" class="save-input" placeholder="0">
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <div class="section-title" data-i18n="secFinal">5. Settlement</div>
    <div class="grid-row">
        <div class="form-group">
            <label data-i18n="lblIsCalled">Is Stock Called Away?</label>
            <select id="isCalledAway" class="save-input" onchange="togglePriceInput()">
                <option value="yes" data-i18n="optYes">Yes (Sold)</option>
                <option value="no" data-i18n="optNo">No (Holding)</option>
            </select>
        </div>
        <div class="form-group" id="finalPriceGroup" style="display:none;">
            <label data-i18n="lblCurrPrice">Current Stock Price</label>
            <input type="number" id="currentPrice" class="save-input" value="52" step="0.1">
        </div>
    </div>

    <button class="btn-calc" onclick="calculate()" data-i18n="btnCalc">Analyze Performance</button>

    <div class="result-card" id="resultSection" style="display:none;">
        
        <div class="result-row">
            <span data-i18n="resBreakeven">Breakeven Price (Cost Basis):</span>
            <span id="resBreakeven" class="neutral" style="font-size: 1.1rem;">$0</span>
        </div>
        <div class="result-row">
            <span data-i18n="resSafety">Downside Protection:</span>
            <span id="resSafety" class="highlight-box">0%</span>
        </div>

        <div class="divider" style="margin: 15px 0;"></div>

        <div class="result-row">
            <span data-i18n="resFinalStrike">Effective Sell Strike:</span>
            <span id="resFinalStrike" style="font-weight: bold; color: var(--info-color);">$0</span>
        </div>

        <div class="result-row">
            <span data-i18n="resPremium">Gross Premium (All):</span>
            <span id="resPremium" class="profit">+$0</span>
        </div>
        
        <div class="result-row">
            <span data-i18n="resCloseCost">Close Cost (Buy Back):</span>
            <span id="resCloseCost" class="close-cost">-$0</span>
        </div>
        
        <div class="result-row">
            <span data-i18n="resNetPremium">Net Premium:</span>
            <span id="resNetPremium" class="profit">+$0</span>
        </div>
        
        <div class="result-row">
            <span data-i18n="resDividend">Dividends:</span>
            <span id="resDividend" class="profit">+$0</span>
        </div>
        <div class="result-row">
            <span data-i18n="resStockPnL">Stock Cap Gain/Loss:</span>
            <span id="resStockPnL">+$0</span>
        </div>

        <div class="result-row total">
            <span data-i18n="resPnL">Total Wheel Profit:</span>
            <span id="resTotalPnL">$0</span>
        </div>
        
        <div class="grid-row" style="margin-top: 15px;">
            <div style="text-align: center;">
                <div style="font-size: 0.9rem; color:var(--muted-text);" data-i18n="resTotalDays">Total Days</div>
                <div id="resTotalDays" style="font-size: 1.2rem; font-weight: 500;">0</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.9rem; color:var(--muted-text);" data-i18n="resROI">ROI</div>
                <div id="resROI" class="profit" style="font-size: 1.2rem; font-weight: bold;">0%</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 0.9rem; color:var(--muted-text);" data-i18n="resAnnROI">Annualized</div>
                <div id="resAnnualized" class="highlight-box" style="font-size: 1.2rem;">0%</div>
            </div>
        </div>

        <div class="benchmark-box">
            <div class="benchmark-title" data-i18n="titleBenchmark">Strategy Comparison (Vs. Buy & Hold)</div>
            
            <div class="result-row">
                <span data-i18n="resBnH">Buy & Hold P&L:</span>
                <span id="resBnH" style="font-weight:bold;">$0</span>
            </div>
            
            <div class="result-row" style="margin-top:8px; border-top:1px solid rgba(255,255,255,0.1); padding-top:8px;">
                <span data-i18n="resVerdict">Verdict (Wheel vs Hold):</span>
                <span id="resVerdict" style="font-weight:bold;">0</span>
            </div>
            <p id="verdictText" class="note" style="margin-bottom:0;">...</p>
        </div>

    </div>
</div>

<script>
    // 1. Localization
    const i18n = {
        en: {
            appTitle: "Wheel Strategy Pro",
            secPut: "1. Capital & Sell Put",
            lblInitCap: "Initial Capital (USD)",
            lblPutStrike: "Put Strike",
            lblPutQty: "Put Contracts (x100)",
            lblPutPrem: "Put Premium",
            lblPutDays: "Put Days",
            secCall: "2. Assignment & Covered Call",
            noteAssigned: "* Only fill if assigned.",
            lblCallStrike: "Initial Call Strike",
            lblCallQty: "Call Contracts (x100)",
            lblCallPrem: "Call Premium",
            lblCallDays: "Call Days",
            lblDividend: "Total Dividends ($)",
            secAdjust: "3. Additional Calls / Rolls",
            noteAdjust: "If New Trade: Enter full Premium. If Rolling: Enter Net Credit (New - Old).",
            lblNewStrike: "Strike (Opt)",
            lblNetCredit: "Premium / Credit",
            lblDays: "Days",
            secClose: "4. Close Sell Call (Buy to Close)",
            noteClose: "If you bought back (closed) any call before expiration, enter the cost here. This reduces your net premium.",
            lblCloseWhich: "Which Call?",
            lblCloseCost: "Close Cost (per share)",
            lblCloseDays: "Days Held",
            optSelectCall: "-- Select --",
            optInitialCall: "Initial Call",
            optRoll1: "Roll #1",
            optRoll2: "Roll #2",
            optRoll3: "Roll #3",
            secFinal: "5. Settlement",
            lblIsCalled: "Stock Called Away?",
            optYes: "Yes (Sold)",
            optNo: "No (Holding)",
            lblCurrPrice: "Current Price",
            btnCalc: "Analyze Performance",
            resBreakeven: "Breakeven Price (Cost Basis):",
            resSafety: "Downside Protection:",
            resFinalStrike: "Effective Sell Strike:",
            resPremium: "Gross Premium (All):",
            resCloseCost: "Close Cost (Buy Back):",
            resNetPremium: "Net Premium:",
            resDividend: "Dividends:",
            resStockPnL: "Stock Value Change:",
            resPnL: "Total Net Profit:",
            resTotalDays: "Days",
            resROI: "ROI",
            resAnnROI: "Annualized",
            titleBenchmark: "Benchmark: Buy & Hold Analysis",
            resBnH: "Buy & Hold Profit:",
            resVerdict: "Wheel Performance:",
            verdictWin: "ğŸ‰ Wheel beat Hold!",
            verdictLose: "ğŸ“‰ Hold was better.",
            msgWin: "Excellent! The Wheel generated more cashflow than simply holding the stock.",
            msgLose: "Stock rallied too fast. You made profit, but holding would have made more (Opportunity Cost).",
            themeBtn: "ğŸŒ Light",
            langBtn: "ä¸­æ–‡",
            btnAscii: "Wheel Strategy Help",
            btnAsciiClose: "Hide",
            asciiTitle: "Wheel Strategy ASCII Guide",
            asciiIntro: "This diagram explains the sell put â†’ assignment â†’ covered call fund cycle.",
        },
        zh: {
            appTitle: "Wheel ç­–ç•¥æ——è‰¦è¨ˆç®—å™¨",
            secPut: "1. è³‡é‡‘èˆ‡ Sell Put",
            lblInitCap: "èµ·å§‹è³‡é‡‘ (USD)",
            lblPutStrike: "Put å±¥ç´„åƒ¹",
            lblPutQty: "Put å¼µæ•¸",
            lblPutPrem: "Put æ¬Šåˆ©é‡‘",
            lblPutDays: "Put æŒæœ‰å¤©æ•¸",
            secCall: "2. è¡Œæ¬Šèˆ‡ Covered Call",
            noteAssigned: "* è‹¥ Put è¢«è¡Œæ¬Šæ‰éœ€å¡«å¯«",
            lblCallStrike: "åˆå§‹ Call å±¥ç´„åƒ¹",
            lblCallQty: "Call å¼µæ•¸",
            lblCallPrem: "Call æ¬Šåˆ©é‡‘",
            lblCallDays: "Call æŒæœ‰å¤©æ•¸",
            lblDividend: "æœŸé–“é ˜å–è‚¡åˆ© ($)",
            secAdjust: "3. é¡å¤–è³£å‡º Call / è½‰å€‰",
            noteAdjust: "è‹¥ç‚ºæ–°äº¤æ˜“ï¼šå¡«å…¨é¡æ¬Šåˆ©é‡‘ã€‚è‹¥ç‚ºè½‰å€‰ï¼šå¡«æ·¨æ¬Šåˆ©é‡‘ (æ–° - èˆŠ)ã€‚",
            lblNewStrike: "å±¥ç´„åƒ¹ (é¸å¡«)",
            lblNetCredit: "æ¬Šåˆ©é‡‘ / æ·¨é¡",
            lblDays: "å¤©æ•¸",
            secClose: "4. å¹³å€‰ Sell Call (è²·å›å¹³å€‰)",
            noteClose: "è‹¥åœ¨åˆ°æœŸå‰è²·å›ï¼ˆå¹³å€‰ï¼‰ä»»ä½• Callï¼Œè«‹åœ¨æ­¤è¼¸å…¥æˆæœ¬ã€‚é€™æœƒæ¸›å°‘æ‚¨çš„æ·¨æ¬Šåˆ©é‡‘æ”¶å…¥ã€‚",
            lblCloseWhich: "å¹³å€‰å“ªå€‹ Call?",
            lblCloseCost: "å¹³å€‰æˆæœ¬ (æ¯è‚¡)",
            lblCloseDays: "æŒæœ‰å¤©æ•¸",
            optSelectCall: "-- é¸æ“‡ --",
            optInitialCall: "åˆå§‹ Call",
            optRoll1: "è½‰å€‰ #1",
            optRoll2: "è½‰å€‰ #2",
            optRoll3: "è½‰å€‰ #3",
            secFinal: "5. æœ€çµ‚çµç®—",
            lblIsCalled: "è‚¡ç¥¨è¢« Call èµ° (è³£å‡º)?",
            optYes: "æ˜¯ (è‚¡åƒ¹ > å±¥ç´„åƒ¹ï¼Œå·²è³£å‡º)",
            optNo: "å¦ (è‚¡åƒ¹ < å±¥ç´„åƒ¹ï¼ŒæŒè‚¡ä¸­)",
            lblCurrPrice: "ç›®å‰å¸‚åƒ¹",
            btnCalc: "åˆ†æç¸¾æ•ˆ",
            resBreakeven: "æç›Šå¹³è¡¡é» (æŒæœ‰æˆæœ¬):",
            resSafety: "ä¸‹è·Œç·©è¡ (Safety):",
            resFinalStrike: "æœ€çµ‚å±¥ç´„è³£åƒ¹:",
            resPremium: "ç¸½æ¬Šåˆ©é‡‘æ”¶å…¥ (æ¯›é¡):",
            resCloseCost: "å¹³å€‰æˆæœ¬ (è²·å›):",
            resNetPremium: "æ·¨æ¬Šåˆ©é‡‘æ”¶å…¥:",
            resDividend: "è‚¡åˆ©æ”¶å…¥:",
            resStockPnL: "è‚¡ç¥¨åƒ¹å·®æç›Š:",
            resPnL: "Wheel ç¸½æ·¨åˆ©:",
            resTotalDays: "ç¸½å¤©æ•¸",
            resROI: "å ±é…¬ç‡",
            resAnnROI: "å¹´åŒ–å ±é…¬",
            titleBenchmark: "ç­–ç•¥å°æ¯”ï¼šè²·å…¥æŒæœ‰ (Buy & Hold)",
            resBnH: "è²·å…¥æŒæœ‰æç›Š:",
            resVerdict: "Wheel è¡¨ç¾:",
            verdictWin: "ğŸ‰ Wheel è·‘è´å¤§ç›¤!",
            verdictLose: "ğŸ“‰ ç›´æ¥æŒè‚¡è³ºæ›´å¤š",
            msgWin: "å¤ªæ£’äº†ï¼æ­¤ç­–ç•¥é€éæ¬Šåˆ©é‡‘å‰µé€ äº†æ¯”å–®ç´”æŒè‚¡æ›´é«˜çš„ç¾é‡‘æµã€‚",
            msgLose: "è‚¡åƒ¹æ¼²å¤ªå¿«äº†ã€‚é›–ç„¶ä½ æœ‰è³ºéŒ¢ï¼Œä½†å¦‚æœç•¶åˆç›´æ¥è²·é€²ä¸¦æŒæœ‰ï¼Œåˆ©æ½¤æœƒæ›´é«˜ (æ©Ÿæœƒæˆæœ¬)ã€‚",
            themeBtn: "ğŸŒ™ Dark",
            langBtn: "English",
            btnAscii: "è¼ªå‹•ç­–ç•¥ èªªæ˜",
            btnAsciiClose: "æ”¶èµ·",
            asciiTitle: "è¼ªå‹•ç­–ç•¥ ASCII æµç¨‹åœ–èªªæ˜",
            asciiIntro: "ä¸‹åœ–ç”¨ç°¡åŒ–æµç¨‹åœ–èªªæ˜ï¼šSell Put â†’ è¡Œæ¬Šå–å¾—è‚¡ç¥¨ â†’ è³£å‡º Covered Call çš„è³‡é‡‘å¾ªç’°ã€‚",
        }
    };

    let currentLang = 'en';

    // 2. Auto-Save
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('.save-input').forEach(input => {
            const savedVal = localStorage.getItem(input.id);
            if (savedVal !== null) input.value = savedVal;
            
            input.addEventListener('change', () => localStorage.setItem(input.id, input.value));
            input.addEventListener('keyup', () => localStorage.setItem(input.id, input.value));
        });
        togglePriceInput();
    });

    function toggleTheme() {
        const html = document.documentElement;
        if (html.getAttribute('data-theme') === 'dark') {
            html.setAttribute('data-theme', 'light');
            updateThemeButtonText('light');
        } else {
            html.setAttribute('data-theme', 'dark');
            updateThemeButtonText('dark');
        }
    }

    function updateThemeButtonText(theme) {
        const btn = document.getElementById('themeBtn');
        btn.innerText = theme === 'light' ? 'ğŸŒ™ Dark' : 'ğŸŒ Light';
    }

    function toggleLang() {
        currentLang = currentLang === 'en' ? 'zh' : 'en';
        renderText();
        if(document.getElementById('resultSection').style.display === 'block') calculate();
    }

    function renderText() {
        const t = i18n[currentLang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (t[key]) el.innerText = t[key];
        });
        document.getElementById('langBtn').innerText = i18n[currentLang].langBtn;
        const currentTheme = document.documentElement.getAttribute('data-theme');
        updateThemeButtonText(currentTheme);
        const asciiBox = document.getElementById('asciiHelp');
        const asciiBtn = document.getElementById('asciiBtn');
        if (asciiBtn && asciiBox) {
            const isVisible = asciiBox.style.display === 'block';
            asciiBtn.innerText = isVisible ? t.btnAsciiClose : t.btnAscii;
        }

        const asciiEn = document.getElementById('asciiEn');
        const asciiZh = document.getElementById('asciiZh');
        if (asciiEn && asciiZh) {
            if (currentLang === 'en') {
                asciiEn.style.display = 'block';
                asciiZh.style.display = 'none';
            } else {
                asciiEn.style.display = 'none';
                asciiZh.style.display = 'block';
            }
        }
    }

    function togglePriceInput() {
        const val = document.getElementById('isCalledAway').value;
        const group = document.getElementById('finalPriceGroup');
        group.style.display = (val === 'no') ? 'flex' : 'none';
    }
    function toggleAsciiHelp() {
        const box = document.getElementById('asciiHelp');
        const btn = document.getElementById('asciiBtn');
        const isHidden = (box.style.display === 'none' || box.style.display === '');

        box.style.display = isHidden ? 'block' : 'none';

        const t = i18n[currentLang];
        btn.innerText = isHidden ? t.btnAsciiClose : t.btnAscii;
    }


    function calculate() {
        // --- Inputs ---
        const initialCapital = parseFloat(document.getElementById('initialCapital').value) || 0;
        
        const putStrike = parseFloat(document.getElementById('putStrike').value) || 0;
        const putQty = parseFloat(document.getElementById('putQty').value) || 0;
        const putPrem = parseFloat(document.getElementById('putPremium').value) || 0;
        const putDays = parseFloat(document.getElementById('putDays').value) || 0;
        
        const callStrike = parseFloat(document.getElementById('callStrike').value) || 0;
        const callQty = parseFloat(document.getElementById('callQty').value) || 0;
        const callPrem = parseFloat(document.getElementById('callPremium').value) || 0;
        const callDays = parseFloat(document.getElementById('callDays').value) || 0;
        const dividends = parseFloat(document.getElementById('dividends').value) || 0;

        // Extra Rolls
        const roll1Strike = parseFloat(document.getElementById('roll1Strike').value) || 0;
        const roll1Prem = parseFloat(document.getElementById('roll1Prem').value) || 0;
        const roll1Days = parseFloat(document.getElementById('roll1Days').value) || 0;
        
        const roll2Strike = parseFloat(document.getElementById('roll2Strike').value) || 0;
        const roll2Prem = parseFloat(document.getElementById('roll2Prem').value) || 0;
        const roll2Days = parseFloat(document.getElementById('roll2Days').value) || 0;
        
        const roll3Strike = parseFloat(document.getElementById('roll3Strike').value) || 0;
        const roll3Prem = parseFloat(document.getElementById('roll3Prem').value) || 0;
        const roll3Days = parseFloat(document.getElementById('roll3Days').value) || 0;
        
        // Close Call Inputs
        const close1Which = document.getElementById('close1Which').value;
        const close1Cost = parseFloat(document.getElementById('close1Cost').value) || 0;
        const close1Days = parseFloat(document.getElementById('close1Days').value) || 0;
        
        const close2Which = document.getElementById('close2Which').value;
        const close2Cost = parseFloat(document.getElementById('close2Cost').value) || 0;
        const close2Days = parseFloat(document.getElementById('close2Days').value) || 0;
        
        const close3Which = document.getElementById('close3Which').value;
        const close3Cost = parseFloat(document.getElementById('close3Cost').value) || 0;
        const close3Days = parseFloat(document.getElementById('close3Days').value) || 0;
        
        const isCalledAway = document.getElementById('isCalledAway').value === 'yes';
        const userCurrentPrice = parseFloat(document.getElementById('currentPrice').value) || 0;

        // --- Logic: Determine Effective Call Strike ---
        // Logic: The LAST entered roll strike is the current one.
        let effectiveCallStrike = callStrike;
        if (roll1Strike > 0) effectiveCallStrike = roll1Strike;
        if (roll2Strike > 0) effectiveCallStrike = roll2Strike;
        if (roll3Strike > 0) effectiveCallStrike = roll3Strike;


        // --- Logic: The Wheel ---
        // Gross Premiums (before any close costs)
        let grossPremiums = (putQty * putPrem * 100) + (callQty * callPrem * 100);
        
        // Extra Rolls Premium
        let extraPremiums = (roll1Prem + roll2Prem + roll3Prem) * putQty * 100;

        const totalGrossPremiums = grossPremiums + extraPremiums;
        
        // Calculate Total Close Costs
        let totalCloseCost = 0;
        let closeDaysTotal = 0;
        
        // Track which calls are closed to adjust days calculation
        let closedCalls = {
            initial: false,
            roll1: false,
            roll2: false,
            roll3: false
        };
        
        if (close1Which && close1Cost > 0) {
            totalCloseCost += close1Cost * callQty * 100;
            closedCalls[close1Which] = true;
            closeDaysTotal += close1Days;
        }
        if (close2Which && close2Cost > 0) {
            totalCloseCost += close2Cost * callQty * 100;
            closedCalls[close2Which] = true;
            closeDaysTotal += close2Days;
        }
        if (close3Which && close3Cost > 0) {
            totalCloseCost += close3Cost * callQty * 100;
            closedCalls[close3Which] = true;
            closeDaysTotal += close3Days;
        }
        
        // Net Premium = Gross - Close Costs
        const netPremiums = totalGrossPremiums - totalCloseCost;
        
        let finalStockPrice = 0;
        if (isCalledAway) {
            finalStockPrice = effectiveCallStrike; // Use Effective Strike!
        } else {
            finalStockPrice = userCurrentPrice;
        }

        let stockPnL = 0;
        // Logic: Assuming Put was assigned, Cost Basis = Put Strike
        if (callQty > 0) {
             if (isCalledAway) {
                // Sold at Effective Strike
                stockPnL = (effectiveCallStrike - putStrike) * callQty * 100; 
            } else {
                // Holding
                stockPnL = (userCurrentPrice - putStrike) * putQty * 100;
            }
        }

        const wheelTotalProfit = netPremiums + stockPnL + dividends;
        
        // Breakeven & Safety (use net premiums for accurate calculation)
        const premPerShare = (putQty > 0) ? (netPremiums / (putQty * 100)) : 0;
        const divPerShare = (putQty > 0) ? (dividends / (putQty * 100)) : 0;
        const breakeven = putStrike - premPerShare - divPerShare;
        const safetyMargin = (putStrike > 0) ? ((putStrike - breakeven) / putStrike) * 100 : 0;

        // Calculate Total Days
        // For closed positions, use the close days instead of original expiration days
        let totalDays = putDays;
        
        // Add call days - but if closed, use close days instead
        if (closedCalls.initial && close1Which === 'initial') {
            totalDays += close1Days;
        } else if (closedCalls.initial && close2Which === 'initial') {
            totalDays += close2Days;
        } else if (closedCalls.initial && close3Which === 'initial') {
            totalDays += close3Days;
        } else {
            totalDays += callDays;
        }
        
        // Add roll days - but if closed, use close days instead
        if (roll1Prem > 0 || roll1Strike > 0) {
            if (closedCalls.roll1) {
                // Days already counted in close
            } else {
                totalDays += roll1Days;
            }
        }
        if (roll2Prem > 0 || roll2Strike > 0) {
            if (closedCalls.roll2) {
                // Days already counted in close
            } else {
                totalDays += roll2Days;
            }
        }
        if (roll3Prem > 0 || roll3Strike > 0) {
            if (closedCalls.roll3) {
                // Days already counted in close
            } else {
                totalDays += roll3Days;
            }
        }
        
        // Add close days for non-initial closes
        if (close1Which && close1Which !== 'initial' && close1Cost > 0) {
            totalDays += close1Days;
        }
        if (close2Which && close2Which !== 'initial' && close2Cost > 0) {
            totalDays += close2Days;
        }
        if (close3Which && close3Which !== 'initial' && close3Cost > 0) {
            totalDays += close3Days;
        }
        
        const roi = (initialCapital > 0) ? (wheelTotalProfit / initialCapital) * 100 : 0;
        const annualized = (totalDays > 0) ? (roi / totalDays) * 365 : 0;

        // --- Logic: Benchmark (Buy & Hold) ---
        // Scenario: Bought shares at Put Strike on Day 1
        const bnhProfit = ((finalStockPrice - putStrike) * putQty * 100) + dividends;
        const wheelOutperformed = wheelTotalProfit > bnhProfit;
        const diff = wheelTotalProfit - bnhProfit;

        // --- Render ---
        document.getElementById('resultSection').style.display = 'block';

        // Top Stats
        document.getElementById('resBreakeven').innerText = `$${breakeven.toFixed(2)}`;
        document.getElementById('resSafety').innerText = `${safetyMargin.toFixed(2)}%`;
        document.getElementById('resFinalStrike').innerText = `$${effectiveCallStrike.toFixed(2)}`;
        
        // Breakdown
        document.getElementById('resPremium').innerText = `+$${totalGrossPremiums.toFixed(2)}`;
        
        // Close Cost
        const closeCostEl = document.getElementById('resCloseCost');
        if (totalCloseCost > 0) {
            closeCostEl.innerText = `-$${totalCloseCost.toFixed(2)}`;
            closeCostEl.className = 'close-cost';
        } else {
            closeCostEl.innerText = `$0.00`;
            closeCostEl.className = '';
        }
        
        // Net Premium
        const netPremEl = document.getElementById('resNetPremium');
        netPremEl.innerText = (netPremiums >= 0 ? '+' : '') + `$${netPremiums.toFixed(2)}`;
        netPremEl.className = (netPremiums >= 0) ? 'profit' : 'loss';
        
        document.getElementById('resDividend').innerText = `+$${dividends.toFixed(2)}`;
        
        const stockPnLEl = document.getElementById('resStockPnL');
        stockPnLEl.innerText = (stockPnL >= 0 ? '+' : '') + `$${stockPnL.toFixed(2)}`;
        stockPnLEl.className = (stockPnL >= 0) ? 'profit' : 'loss';

        // Grand Total
        const totalPnLEl = document.getElementById('resTotalPnL');
        totalPnLEl.innerText = (wheelTotalProfit >= 0 ? '+' : '') + `$${wheelTotalProfit.toFixed(2)}`;
        totalPnLEl.className = (wheelTotalProfit >= 0) ? 'profit result-row total' : 'loss result-row total';

        // ROI
        document.getElementById('resTotalDays').innerText = totalDays;
        
        const roiEl = document.getElementById('resROI');
        roiEl.innerText = `${roi.toFixed(2)}%`;
        roiEl.className = (roi >= 0) ? 'profit' : 'loss';

        document.getElementById('resAnnualized').innerText = `${annualized.toFixed(2)}%`;

        // Benchmark Render
        const bnhEl = document.getElementById('resBnH');
        bnhEl.innerText = (bnhProfit >= 0 ? '+' : '') + `$${bnhProfit.toFixed(2)}`;
        bnhEl.className = (bnhProfit >= 0) ? 'profit' : 'loss';

        const verdictEl = document.getElementById('resVerdict');
        const verdictText = document.getElementById('verdictText');
        const t = i18n[currentLang];

        if (wheelOutperformed) {
            verdictEl.innerText = t.verdictWin + ` (+$${diff.toFixed(2)})`;
            verdictEl.className = 'profit';
            verdictText.innerText = t.msgWin;
        } else {
            verdictEl.innerText = t.verdictLose + ` (-$${Math.abs(diff).toFixed(2)})`;
            verdictEl.className = 'loss';
            verdictText.innerText = t.msgLose;
        }
    }
</script>

</body>
</html>